# The name of the bundle. run `databricks bundle schema` to see the full bundle settings schema.
bundle:
  name: agentops_dev

variables:
  uc_catalog:
    description: Unity Catalog used to store data and artifacts.
    default: scott_donohoo
  schema:
    description: "Schema in Unity Catalog."
  raw_data_table:
    description: "Table in Unity Catalog to store raw data."
    default: raw_documentation
  data_source_url: 
      description: "The url to scrape."
      default: https://docs.databricks.com/en/doc-sitemap.xml
  preprocessed_data_table:
      description: "Table in Unity Catalog to store preprocessed data."
      default: databricks_documentation
  vector_search_endpoint:
    description: "Vector Search endpoint to create."
    default: ai_agent_endpoint
  vector_search_index:
    description: "Vector Search index to populate."
    default: databricks_documentation_vs_index
  experiment:
    description: "Experiment to log run under."
    default: /Workspace/Users/${workspace.current_user.userName}/${bundle.name}-${bundle.target}-agent_function_chatbot
  registered_model:
    description: "Name of agent model to register."
    default: agent_function_chatbot
  agent_serving_endpoint:
    description: "Name of agent model serving endpoint (optional). If empty, agents.deploy() will auto-generate. Must NOT be pre-created in bundle."
    default: ""  # Will be constructed per target below
  foundation_model_endpoint:
    description: "Foundation model endpoint to use for agent."
    default: "databricks-meta-llama-3-3-70b-instruct"
  eval_table:
    description: "Table in Unity Catalog to store evaluation data."
    default: "databricks_documentation_eval"
  model_alias:
    description: "Model alias to use for trained model"
    default: agent_latest
  scale_to_zero:
    description: "Scale model endpoint to zero when not in use."
    default: True
  workload_size:
    description: "Size of compute for anticipated number of concurrent requests."
    default: "Small"
  app_name:
    description: "Name of the Databricks App"
    default: "agentops-chatbot-app"
  # Agent deployment reliability settings
  mlflow_experiment_path:
    description: "Non-Git MLflow experiment path for agent tracing"
    default: ""  # Will auto-generate if not specified
  deploy_max_attempts:
    description: "Maximum agent deployment retry attempts"
    default: 3
  deploy_base_sleep_sec:
    description: "Base sleep seconds for deployment retry backoff"
    default: 10

sync:
  # Sync app deployment files to workspace for CLI-based deployment
  include:
    - agent_deployment/chat_interface_deployment/app.py
    - agent_deployment/chat_interface_deployment/DatabricksChatbot.py
    - agent_deployment/chat_interface_deployment/utils.py
    - agent_deployment/chat_interface_deployment/app.yaml

include:
  # Resources folder contains Agent artifact resources for the Agent project that defines the agent
  # and workflows resources for data preparation -> agent creation & evaluation -> deployment
  - ./resources/data-preparation-resource.yml
  - ./resources/agents-artifacts-resource.yml
  - ./resources/agent-resource.yml
  - ./resources/app-resource.yml  # App resource (deploy with bundle deploy)
  # Uncomment this when you want to deploy monitoring
  # - ./resources/monitoring-resource.yml

# Deployment Target specific values for workspace
targets:
  dev:
    default: true
    variables:
      schema: "agentops_dev"
      agent_serving_endpoint: "agentops-dev-chatbot-endpoint"
    workspace:
      # TODO: add dev workspace URL
      host: https://adb-4077249447582192.12.azuredatabricks.net/

  staging:
    variables:
      schema: "agentops_staging"
      agent_serving_endpoint: "agentops-staging-chatbot-endpoint"
    workspace:
      host: https://adb-4077249447582192.12.azuredatabricks.net/

  prod:
    variables:
      schema: "agentops_prod"
      agent_serving_endpoint: "agentops-prod-chatbot-endpoint"
    workspace:
      host: https://adb-4077249447582192.12.azuredatabricks.net/

  test:
    variables:
      schema: "agentops_staging"
      agent_serving_endpoint: "agentops-test-chatbot-endpoint"
    workspace:
      host: https://adb-4077249447582192.12.azuredatabricks.net/